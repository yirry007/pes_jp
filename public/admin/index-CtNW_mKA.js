import{h as l,r as n,j as e,I as L,T as M,U,B as y,S as V,p as Y}from"./index-C9q2FBSY.js";import{u as N}from"./user-QWRnYbDZ.js";import{l as _}from"./league-CZlIo5rl.js";import{d as v}from"./index-CxR-IuS2.js";import{M as R}from"./index-DA9yrtLn.js";import{T as P}from"./index-CTwM5QEi.js";import{R as D}from"./index-BfF7_6j9.js";import{D as q,F as z}from"./index-BhUjsVSm.js";import{u as E}from"./index-BtVQP8yc.js";import{S as B}from"./SearchForm--fHSw7Ey.js";import{a as H,D as F}from"./index-BdVQ0fKq.js";import{L as f}from"./index-BWFF0J93.js";import{A as T}from"./index-9rTpl9La.js";import{T as O}from"./index-CXwXhMOH.js";import{F as G}from"./Table-Aik4FbcR.js";import"./useIcons-B3ELihdy.js";const K=h=>{const[r]=l.useForm(),[x,i]=n.useState(!1),[j,d]=n.useState("create"),{RangePicker:b}=q,k={rules:[{type:"array",required:!0,message:"请选择日期"}]};n.useImperativeHandle(h.mRef,()=>({open:w}));const w=(t,a)=>{if(d(t),i(!0),t==="create"&&r.setFieldsValue({game_mode:1}),t==="edit"&&a){const p=[v(a.start_date),v(a.end_date)];r.setFieldsValue({...a,game_date:p})}},o=async()=>{if(await r.validateFields()){const a={...r.getFieldsValue()};a.start_date=v(a.game_date[0]).format("YYYY-MM-DD"),a.end_date=v(a.game_date[1]).format("YYYY-MM-DD"),delete a.game_date,j==="create"?await _.createLeague(a):await _.editLeague(a),c(),h.update()}},c=()=>{i(!1),r.resetFields()};return e.jsx(R,{title:j==="create"?"创建联赛":"编辑联赛",okText:"确定",cancelText:"取消",width:800,open:x,onOk:o,onCancel:c,children:e.jsxs(l,{form:r,labelCol:{span:4},labelAlign:"right",children:[e.jsx(l.Item,{name:"id",hidden:!0,children:e.jsx(L,{})}),e.jsx(l.Item,{label:"联赛名称",name:"name",rules:[{required:!0,message:"请输入联赛名称"}],children:e.jsx(L,{placeholder:"请输入联赛名称"})}),e.jsx(l.Item,{label:"参赛人数",name:"user_number",rules:[{required:!0,message:"请输入参赛人数"}],children:e.jsx(P,{placeholder:"请输入参赛人数"})}),e.jsx(l.Item,{name:"game_mode",label:"联赛模式",children:e.jsxs(D.Group,{children:[e.jsx(D,{value:1,children:"单场"}),e.jsx(D,{value:2,children:"主客场"})]})}),e.jsx(l.Item,{name:"game_date",label:"比赛日期",...k,children:e.jsx(b,{})}),e.jsx(l.Item,{name:"memo",label:"备注",children:e.jsx(L.TextArea,{})})]})})},X=h=>{const[r,x]=n.useState(!1),[i,j]=n.useState(),[d,b]=n.useState(),[k,w]=n.useState([]),[o,c]=n.useState([]),{Text:t}=O;n.useImperativeHandle(h.mRef,()=>({open:p}));const a={name:"联赛名称",user_number:"参赛人数",game_mode:"联赛模式",start_date:"开始日期",end_date:"结束日期"},p=s=>{const u=s.league;j(u),w(s.all_users),c(s.league_users),x(!0);const I=[];for(let m in u)["name","user_number","start_date","end_date"].includes(m)&&I.push({key:m,label:a[m],children:u[m]}),m==="game_mode"&&I.push({key:m,label:a[m],children:u[m]===1?"单场":"主客场"});b(I)},g=s=>{const u=o.filter(I=>I.id!==s.id);c([...u,s])},A=s=>{c(o.filter(u=>u.id!==s.id))},C=async s=>{await _.updateLeagueData({id:i==null?void 0:i.id,users:o,create_game:s}),s&&S()},S=()=>{x(!1)};return e.jsxs(R,{title:"参赛用户",width:800,open:r,onCancel:S,footer:[],children:[e.jsx(H,{items:d}),e.jsx(F,{}),e.jsx("div",{style:{height:"500px",overflowY:"scroll",overflowX:"hidden"},children:e.jsxs(M,{gutter:120,children:[e.jsxs(U,{span:12,children:[e.jsx(t,{type:"secondary",children:"用户列表"}),e.jsx(f,{itemLayout:"horizontal",dataSource:k,renderItem:s=>e.jsx(f.Item,{style:{cursor:"pointer"},onClick:()=>{g(s)},children:e.jsx(f.Item.Meta,{avatar:e.jsx(T,{src:s.head_image_url}),title:s.nickname,description:s.phone})})})]}),e.jsxs(U,{span:12,children:[e.jsx(t,{type:"secondary",children:"参赛用户"}),e.jsx(f,{itemLayout:"horizontal",dataSource:o,renderItem:s=>e.jsx(f.Item,{style:{cursor:"pointer"},onClick:()=>{A(s)},children:e.jsx(f.Item.Meta,{avatar:e.jsx(T,{src:s.head_image_url}),title:s.nickname,description:s.phone})})})]})]})}),e.jsx(F,{}),e.jsxs(z,{gap:"small",justify:"flex-end",children:[e.jsx(y,{type:"primary",onClick:()=>{C(!1)},children:"确认"}),e.jsx(y,{type:"primary",onClick:()=>{C(!0)},children:"确认并创建比赛"})]})]})};function ue(){const[h]=l.useForm(),r=n.useRef(),x=n.useRef(),i=({current:t,pageSize:a},p)=>_.getLeagueList({...p,pageNum:t,pageSize:a}).then(g=>({total:g.page.total,list:g.list})),{tableProps:j,search:d}=E(i,{form:h,defaultPageSize:10}),b=()=>{var t;(t=r.current)==null||t.open("create")},k=t=>{var a;(a=r.current)==null||a.open("edit",t)},w=async t=>{var g;const a=await N.getAllUsers(),p=await _.getLeagueUsers({id:t.id});(g=x.current)==null||g.open({league:t,all_users:a,league_users:p})},o=t=>{Y.confirm({title:"删除确认",content:e.jsx("span",{children:"确认删除该联赛吗？"}),okText:"确定",cancelText:"取消",onOk:async()=>{try{await _.delLeague({id:t}),d.reset()}catch{}}})},c=[{title:"ID",dataIndex:"id",key:"id",width:40},{title:"联赛名称",dataIndex:"name",key:"name",width:160},{title:"参赛人数",dataIndex:"user_number",key:"user_number",width:100},{title:"联赛模式",dataIndex:"game_mode",key:"game_mode",width:160,render(t){return t===1?"单场":"主客场"}},{title:"开始日期",dataIndex:"start_date",key:"start_date",width:160},{title:"结束日期",dataIndex:"end_date",key:"end_date",width:160},{title:"备注",dataIndex:"memo",key:"memo",width:240},{title:"操作",key:"operations",width:150,render(t){return e.jsxs(V,{children:[e.jsx(y,{type:"text",onClick:()=>w(t),children:"参赛用户"}),e.jsx(y,{type:"text",onClick:()=>k(t),children:"编辑"}),e.jsx(y,{type:"text",danger:!0,onClick:()=>o(t.id),children:"删除"})]})}}];return e.jsxs("div",{children:[e.jsx(B,{form:h,initialValues:{state:1},submit:d.submit,reset:d.reset,children:e.jsx(l.Item,{name:"name",label:"联赛名称",children:e.jsx(L,{placeholder:"请输入联赛名称"})})}),e.jsxs("div",{className:"base-table",children:[e.jsxs("div",{className:"header-wrapper",children:[e.jsx("div",{className:"title",children:"联赛列表"}),e.jsx("div",{className:"action",children:e.jsx(y,{type:"primary",onClick:b,children:"新增"})})]}),e.jsx(G,{bordered:!0,rowKey:"id",columns:c,...j})]}),e.jsx(K,{mRef:r,update:()=>{d.reset()}}),e.jsx(X,{mRef:x})]})}export{ue as default};
