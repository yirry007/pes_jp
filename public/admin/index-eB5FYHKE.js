import{h as l,r as n,j as e,I as v,T as M,U,B as y,S as V,p as Y}from"./index-C9q2FBSY.js";import{u as L}from"./user-QWRnYbDZ.js";import{c as _}from"./cup-DYMywX8B.js";import{d as I}from"./index-CxR-IuS2.js";import{M as R}from"./index-DA9yrtLn.js";import{T as N}from"./index-CTwM5QEi.js";import{D as P,F as q}from"./index-BhUjsVSm.js";import{u as z}from"./index-BtVQP8yc.js";import{S as E}from"./SearchForm--fHSw7Ey.js";import{a as B,D}from"./index-BdVQ0fKq.js";import{L as f}from"./index-BWFF0J93.js";import{A as T}from"./index-9rTpl9La.js";import{T as H}from"./index-CXwXhMOH.js";import{F as O}from"./Table-Aik4FbcR.js";import"./useIcons-B3ELihdy.js";import"./index-BfF7_6j9.js";const K=m=>{const[r]=l.useForm(),[p,o]=n.useState(!1),[j,d]=n.useState("create"),{RangePicker:C}=P,g={rules:[{type:"array",required:!0,message:"请选择日期"}]};n.useImperativeHandle(m.mRef,()=>({open:b}));const b=(t,s)=>{if(d(t),o(!0),t==="create"&&r.setFieldsValue({game_mode:1}),t==="edit"&&s){const x=[I(s.start_date),I(s.end_date)];r.setFieldsValue({...s,game_date:x})}},c=async()=>{if(await r.validateFields()){const s={...r.getFieldsValue()};s.start_date=I(s.game_date[0]).format("YYYY-MM-DD"),s.end_date=I(s.game_date[1]).format("YYYY-MM-DD"),delete s.game_date,j==="create"?await _.createCup(s):await _.editCup(s),u(),m.update()}},u=()=>{o(!1),r.resetFields()};return e.jsx(R,{title:j==="create"?"创建杯赛":"编辑杯赛",okText:"确定",cancelText:"取消",width:800,open:p,onOk:c,onCancel:u,children:e.jsxs(l,{form:r,labelCol:{span:4},labelAlign:"right",children:[e.jsx(l.Item,{name:"id",hidden:!0,children:e.jsx(v,{})}),e.jsx(l.Item,{label:"杯赛名称",name:"name",rules:[{required:!0,message:"请输入杯赛名称"}],children:e.jsx(v,{placeholder:"请输入杯赛名称"})}),e.jsx(l.Item,{label:"参赛人数",name:"user_number",rules:[{required:!0,message:"请输入参赛人数"}],children:e.jsx(N,{placeholder:"请输入参赛人数"})}),e.jsx(l.Item,{name:"game_date",label:"比赛日期",...g,children:e.jsx(C,{})}),e.jsx(l.Item,{name:"memo",label:"备注",children:e.jsx(v.TextArea,{})})]})})},X=m=>{const[r,p]=n.useState(!1),[o,j]=n.useState(),[d,C]=n.useState(),[g,b]=n.useState([]),[c,u]=n.useState([]),{Text:t}=H;n.useImperativeHandle(m.mRef,()=>({open:x}));const s={name:"杯赛名称",user_number:"参赛人数",start_date:"开始日期",end_date:"结束日期"},x=a=>{const i=a.cup;j(i),b(a.all_users),u(a.cup_users),p(!0);const k=[];for(let w in i)["name","user_number","start_date","end_date"].includes(w)&&k.push({key:w,label:s[w],children:i[w]});C(k)},h=a=>{const i=c.filter(k=>k.id!==a.id);u([...i,a])},A=a=>{u(c.filter(i=>i.id!==a.id))},F=async a=>{await _.updateCupData({id:o==null?void 0:o.id,users:c,create_game:a}),a&&S()},S=()=>{p(!1)};return e.jsxs(R,{title:"参赛用户",width:800,open:r,onCancel:S,footer:[],children:[e.jsx(B,{items:d}),e.jsx(D,{}),e.jsx("div",{style:{height:"500px",overflowY:"scroll",overflowX:"hidden"},children:e.jsxs(M,{gutter:120,children:[e.jsxs(U,{span:12,children:[e.jsx(t,{type:"secondary",children:"用户列表"}),e.jsx(f,{itemLayout:"horizontal",dataSource:g,renderItem:a=>e.jsx(f.Item,{style:{cursor:"pointer"},onClick:()=>{h(a)},children:e.jsx(f.Item.Meta,{avatar:e.jsx(T,{src:a.head_image_url}),title:a.nickname,description:a.phone})})})]}),e.jsxs(U,{span:12,children:[e.jsx(t,{type:"secondary",children:"参赛用户"}),e.jsx(f,{itemLayout:"horizontal",dataSource:c,renderItem:(a,i)=>e.jsxs(e.Fragment,{children:[e.jsx(f.Item,{style:{cursor:"pointer",border:"none"},onClick:()=>{A(a)},children:e.jsx(f.Item.Meta,{avatar:e.jsx(T,{src:a.head_image_url}),title:a.nickname,description:a.phone})}),i%2?e.jsx(D,{}):""]})})]})]})}),e.jsx(D,{}),e.jsxs(q,{gap:"small",justify:"flex-end",children:[e.jsx(y,{type:"primary",onClick:()=>{F(!1)},children:"确认"}),e.jsx(y,{type:"primary",onClick:()=>{F(!0)},children:"确认并创建比赛"})]})]})};function ce(){const[m]=l.useForm(),r=n.useRef(),p=n.useRef(),o=({current:t,pageSize:s},x)=>_.getCupList({...x,pageNum:t,pageSize:s}).then(h=>({total:h.page.total,list:h.list})),{tableProps:j,search:d}=z(o,{form:m,defaultPageSize:10}),C=()=>{var t;(t=r.current)==null||t.open("create")},g=t=>{var s;(s=r.current)==null||s.open("edit",t)},b=async t=>{var h;const s=await L.getAllUsers(),x=await _.getCupUsers({id:t.id});(h=p.current)==null||h.open({cup:t,all_users:s,cup_users:x})},c=t=>{Y.confirm({title:"删除确认",content:e.jsx("span",{children:"确认删除该杯赛吗？"}),okText:"确定",cancelText:"取消",onOk:async()=>{try{await _.delCup({id:t}),d.reset()}catch{}}})},u=[{title:"ID",dataIndex:"id",key:"id",width:40},{title:"杯赛名称",dataIndex:"name",key:"name",width:180},{title:"参赛人数",dataIndex:"user_number",key:"user_number",width:120},{title:"开始日期",dataIndex:"start_date",key:"start_date",width:180},{title:"结束日期",dataIndex:"end_date",key:"end_date",width:180},{title:"备注",dataIndex:"memo",key:"memo",width:270},{title:"操作",key:"operations",width:150,render(t){return e.jsxs(V,{children:[e.jsx(y,{type:"text",onClick:()=>b(t),children:"参赛用户"}),e.jsx(y,{type:"text",onClick:()=>g(t),children:"编辑"}),e.jsx(y,{type:"text",danger:!0,onClick:()=>c(t.id),children:"删除"})]})}}];return e.jsxs("div",{children:[e.jsx(E,{form:m,initialValues:{state:1},submit:d.submit,reset:d.reset,children:e.jsx(l.Item,{name:"name",label:"杯赛名称",children:e.jsx(v,{placeholder:"请输入杯赛名称"})})}),e.jsxs("div",{className:"base-table",children:[e.jsxs("div",{className:"header-wrapper",children:[e.jsx("div",{className:"title",children:"杯赛列表"}),e.jsx("div",{className:"action",children:e.jsx(y,{type:"primary",onClick:C,children:"新增"})})]}),e.jsx(O,{bordered:!0,rowKey:"id",columns:u,...j})]}),e.jsx(K,{mRef:r,update:()=>{d.reset()}}),e.jsx(X,{mRef:p})]})}export{ce as default};
