import{h as n,r as d,j as e,I as h,s as T,i as _,k as A,n as y,B as I,o as N,S as z,p as L}from"./index-C9q2FBSY.js";import{u as j}from"./user-QWRnYbDZ.js";import{M as O}from"./index-DA9yrtLn.js";import{S as q}from"./index-BfF7_6j9.js";import{U as V}from"./index-BmaZIg_e.js";import{u as B}from"./index-BtVQP8yc.js";import{S as D}from"./SearchForm--fHSw7Ey.js";import{F as E}from"./Table-Aik4FbcR.js";import{A as F}from"./index-9rTpl9La.js";import"./useIcons-B3ELihdy.js";const J=c=>{const[i]=n.useForm(),[f,x]=d.useState(!1),[o,b]=d.useState("create"),[m,u]=d.useState(""),[k,t]=d.useState(!1),r=[];d.useImperativeHandle(c.mRef,()=>({open:l}));const l=(s,a)=>{b(s),x(!0),s==="edit"&&a&&(i.setFieldsValue(a),u(a.head_image_url))},g=async()=>{if(await i.validateFields()){const a={...i.getFieldsValue(),head_image_url:m};o==="create"?await j.createUser(a):await j.editUser(a),v(),c.update()}},v=()=>{x(!1),u(""),i.resetFields()},C=s=>{const a=s.type==="image/jpeg"||s.type==="image/png";if(!a)return y.error("只能上传png或jpeg格式的图片"),!1;const p=s.size/1024/1024<.5;return p||y.error("图片不能超过500K"),a&&p},w=s=>{var a,p;if(((a=s.file)==null?void 0:a.status)==="uploading"){t(!0);return}if(((p=s.file)==null?void 0:p.status)==="done"){t(!1);const{code:U,result:R,message:S}=s.file.response;U===""?u(R):S.error(S)}else s.file.status==="error"&&y.error("服务器异常，请稍后重试")};return e.jsx(O,{title:o==="create"?"创建用户":"编辑用户",okText:"确定",cancelText:"取消",width:800,open:f,onOk:g,onCancel:v,children:e.jsxs(n,{form:i,labelCol:{span:4},labelAlign:"right",children:[e.jsx(n.Item,{name:"id",hidden:!0,children:e.jsx(h,{})}),e.jsx(n.Item,{label:"手机号",name:"phone",rules:[{required:!0,len:11,message:"请输入11位手机号"},{pattern:/1[1-9]\d{9}/,message:"请输入1开头的11位手机号"}],children:e.jsx(h,{type:"number",placeholder:"请输入手机号"})}),e.jsx(n.Item,{label:"用户名称",name:"nickname",rules:[{required:!0,message:"请输入用户名称"},{min:2,max:12,message:"用户名称最小5个字符，最大12个字符"}],children:e.jsx(h,{placeholder:"请输入用户名称"})}),e.jsx(n.Item,{label:"用户标签",name:"tags",children:e.jsx(q,{mode:"tags",style:{width:"100%"},onChange:w,tokenSeparators:[","],options:r})}),e.jsx(n.Item,{label:"用户头像",children:e.jsx(V,{listType:"picture-card",showUploadList:!1,headers:{Authorization:"Bearer "+T.get("token").access_token},action:"/api/admin/upload",beforeUpload:C,onChange:w,children:m?e.jsx("img",{src:m,style:{width:"100%",borderRadius:"100%"}}):e.jsxs("div",{children:[k?e.jsx(_,{rev:void 0}):e.jsx(A,{rev:void 0}),e.jsx("div",{style:{marginTop:5},children:"上传头像"})]})})})]})})};function Z(){const[c]=n.useForm(),i=d.useRef(),f=({current:t,pageSize:r},l)=>j.getUserList({...l,pageNum:t,pageSize:r}).then(g=>({total:g.page.total,list:g.list})),{tableProps:x,search:o}=B(f,{form:c,defaultPageSize:10}),b=()=>{var t;(t=i.current)==null||t.open("create")},m=t=>{var l;const r=JSON.parse(t.tags);(l=i.current)==null||l.open("edit",{...t,tags:r})},u=t=>{L.confirm({title:"删除确认",content:e.jsx("span",{children:"确认删除该用户吗？"}),okText:"确定",cancelText:"取消",onOk:async()=>{try{await j.delUser({id:t}),o.reset()}catch{}}})},k=[{title:"ID",dataIndex:"id",key:"id",width:60},{title:"头像",dataIndex:"head_image_url",key:"head_image_url",width:160,render(t){return t?e.jsx(F,{shape:"square",size:48,src:t}):e.jsx(F,{shape:"square",size:48,icon:e.jsx(N,{})})}},{title:"手机号",dataIndex:"phone",key:"phone",width:240},{title:"用户名称",dataIndex:"nickname",key:"nickname",width:300},{title:"标签",dataIndex:"tags",key:"tags",render(t){let r;try{r=JSON.parse(t)}catch(l){console.log(l),r=[]}return r.join(" / ")}},{title:"操作",key:"operations",width:120,render(t){return e.jsxs(z,{children:[e.jsx(I,{type:"text",onClick:()=>m(t),children:"编辑"}),e.jsx(I,{type:"text",danger:!0,onClick:()=>u(t.id),children:"删除"})]})}}];return e.jsxs("div",{children:[e.jsxs(D,{form:c,initialValues:{state:1},submit:o.submit,reset:o.reset,children:[e.jsx(n.Item,{name:"phone",label:"手机号",children:e.jsx(h,{placeholder:"请输入用户手机号"})}),e.jsx(n.Item,{name:"nickname",label:"用户名称",children:e.jsx(h,{placeholder:"请输入用户名称"})})]}),e.jsxs("div",{className:"base-table",children:[e.jsxs("div",{className:"header-wrapper",children:[e.jsx("div",{className:"title",children:"用户列表"}),e.jsx("div",{className:"action",children:e.jsx(I,{type:"primary",onClick:b,children:"新增"})})]}),e.jsx(E,{bordered:!0,rowKey:"phone",columns:k,...x})]}),e.jsx(J,{mRef:i,update:()=>{o.reset()}})]})}export{Z as default};
